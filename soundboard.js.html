<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>~/koppismount/soundboard.js.html</title>
<meta name="Generator" content="Vim/7.4">
<meta name="plugin-version" content="vim7.4_v1">
<meta name="syntax" content="javascript">
<meta name="settings" content="use_css,pre_wrap,no_foldcolumn,expand_tabs,prevent_copy=">
<meta name="colorscheme" content="desert">
<style type="text/css">
<!--
pre { white-space: pre-wrap; font-family: monospace; color: #ffffff; background-color: #333333; }
body { font-family: monospace; color: #ffffff; background-color: #333333; }
* { font-size: 1em; }
.Type { color: #bdb76b; font-weight: bold; }
.Statement { color: #f0e68c; font-weight: bold; }
.Comment { color: #87ceeb; }
.Constant { color: #ffa0a0; }
.Special { color: #ffdead; }
.Identifier { color: #98fb98; }
-->
</style>

<script type='text/javascript'>
<!--

-->
</script>
</head>
<body>
<pre id='vimCodeElement'>

<span class="Comment">//init</span>
<span class="Identifier">var</span> version = 11;
<span class="Identifier">var</span> files;
<span class="Identifier">var</span> recording = 0;
<span class="Identifier">var</span> online = 0;
<span class="Identifier">var</span> t; <span class="Comment">//setTimeout</span>
<span class="Identifier">var</span> vitsit_revision = -1;
<span class="Identifier">var</span> emoticons_revision = -1;
<span class="Identifier">var</span> recordings_revision = -1;
<span class="Identifier">var</span> teamspeak_revision = -1;
<span class="Identifier">var</span> teamspeak_chat_rowid = -1;
<span class="Identifier">var</span> youtube_rowid = 0;
<span class="Identifier">var</span> cookie_rowid = -1;
<span class="Identifier">var</span> session = <span class="Constant">&quot;&quot;</span>;
<span class="Identifier">var</span> rec_playcounts;
<span class="Identifier">var</span> shoutbox_counter;
<span class="Identifier">var</span> focusvar = 1;
<span class="Identifier">var</span> happening = <span class="Constant">false</span>;
<span class="Identifier">var</span> vilkku = <span class="Constant">false</span>;
<span class="Identifier">var</span> usercolor = <span class="Constant">&quot;&quot;</span>;
<span class="Identifier">var</span> username = <span class="Constant">&quot;&quot;</span>;


<span class="Comment">//console.log = function(msg){};</span>

<span class="Statement">document</span>.title = <span class="Constant">&quot;Koppislandia&quot;</span>;
<span class="Statement">if</span> ((<span class="Constant">/iPhone|iPod|iPad|Android|BlackBerry/</span>).test(navigator.userAgent)) <span class="Identifier">{</span>
    mobile = <span class="Constant">true</span>;
    <span class="Identifier">var</span> ajaxtimeout = 1000;
    $(<span class="Constant">&quot;#usercolor&quot;</span>).val(<span class="Constant">'#000000'</span>)
<span class="Identifier">}</span> <span class="Statement">else</span> <span class="Identifier">{</span>
    mobile = <span class="Constant">false</span>;
    <span class="Identifier">var</span> ajaxtimeout = 120000;
<span class="Identifier">}</span>
<span class="Comment">//endinit</span>


<span class="Comment">//Kun focus tulee textarea-luokkaan</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;focus&quot;</span>,<span class="Constant">&quot;.textarea&quot;</span>,<span class="Identifier">function</span>(e)<span class="Identifier">{</span>
    <span class="Statement">if</span> ($(<span class="Identifier">this</span>).val() == $(<span class="Identifier">this</span>).attr(<span class="Constant">'alt'</span>))<span class="Identifier">{</span>
        $(<span class="Identifier">this</span>).val(<span class="Constant">&quot;&quot;</span>);
        <span class="Identifier">}</span>
<span class="Identifier">}</span>);
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;blur&quot;</span>,<span class="Constant">&quot;.textarea&quot;</span>,<span class="Identifier">function</span>(e)<span class="Identifier">{</span>
    <span class="Statement">if</span> ($(<span class="Constant">&quot;#username&quot;</span>).val() == <span class="Constant">&quot;ADMIN&quot;</span>)
        $(<span class="Constant">&quot;#username&quot;</span>).val(<span class="Constant">&quot;&quot;</span>);
    <span class="Statement">if</span> ($(<span class="Identifier">this</span>).val() == <span class="Constant">&quot;&quot;</span>)
        $(<span class="Identifier">this</span>).val($(<span class="Identifier">this</span>).attr(<span class="Constant">'alt'</span>));
<span class="Identifier">}</span>);



<span class="Comment">//Kun ikkunaan tulee focus/pois focus</span>
$(<span class="Statement">window</span>).on(<span class="Constant">'focus'</span>, <span class="Identifier">function</span>() <span class="Identifier">{</span>
    <span class="Statement">document</span>.title = <span class="Constant">&quot;Koppislandia&quot;</span>;
    focusvar = 1;
    happening = <span class="Constant">false</span>;
<span class="Identifier">}</span>);
$(<span class="Statement">window</span>).blur(<span class="Identifier">function</span>() <span class="Identifier">{</span>
    focusvar = 0;
<span class="Identifier">}</span>);

<span class="Comment">//Yritä disconnectia vielä, ettei hyvällä tuurilla tarvitse timeouttia</span>
$(<span class="Statement">window</span>).on(<span class="Constant">&quot;beforeunload&quot;</span>, <span class="Identifier">function</span>() <span class="Identifier">{</span>
    $.ajax(<span class="Identifier">{</span>
        type: <span class="Constant">'GET'</span>,
        url: <span class="Constant">'disconnect.php'</span>,
        data: <span class="Identifier">{</span>user:$(<span class="Constant">'#username'</span>).val()<span class="Identifier">}</span>,
        async: <span class="Constant">true</span>
    <span class="Identifier">}</span>);
<span class="Identifier">}</span>);

<span class="Comment">/* </span>
<span class="Comment"> * SHOUTBOX</span>
<span class="Comment"> */</span>

<span class="Identifier">function</span> chatmessage()<span class="Identifier">{</span>
    <span class="Identifier">var</span> val = $(<span class="Constant">'#tts'</span>).val();
    <span class="Identifier">var</span> usr = $(<span class="Constant">'#username'</span>).val();

    <span class="Statement">if</span> (val.length &gt; 0 &amp;&amp; val.length &lt; 5000 &amp;&amp; val !== <span class="Constant">&quot;Text-to-speech&quot;</span>) <span class="Identifier">{</span>
        postmessage(usr,val,$( <span class="Constant">&quot;#kieli&quot;</span> ).val(),<span class="Constant">true</span>);



        value = addslashes(val);

        <span class="Identifier">var</span> edellinen;
        edellinen = ma.indexOf(value);

        <span class="Statement">while</span> (edellinen !== -1)<span class="Identifier">{</span>
            ma.splice(edellinen,1)
            edellinen = ma.indexOf(value);
        <span class="Identifier">}</span>
        <span class="Statement">if</span> (ma<span class="Identifier">[</span>ma.length-1<span class="Identifier">]</span> != value)
            ma.push(value);
        <span class="Statement">if</span> (ma.length &gt; 100)
            ma.splice(0,1);
        shoutbox_counter = ma.length;

        $.cookie(<span class="Constant">&quot;sentmessages&quot;</span>, JSON.stringify(ma) , <span class="Identifier">{</span> expires : 10 <span class="Identifier">}</span>);

        $(<span class="Constant">&quot;#tts&quot;</span>).val(<span class="Constant">''</span>);
    <span class="Identifier">}</span>

<span class="Identifier">}</span>

<span class="Comment">//Kun painetaan viestikentässä enter tai ylösalas</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">'keydown'</span>,<span class="Constant">'#tts'</span>,<span class="Identifier">function</span>(a)<span class="Identifier">{</span>
    <span class="Statement">if</span> (a.keyCode == 40) <span class="Identifier">{</span>
        <span class="Statement">if</span> (shoutbox_counter &lt; (ma.length-1))<span class="Identifier">{</span>
            shoutbox_counter += 1;
            $(<span class="Constant">'#tts'</span>).val(ma<span class="Identifier">[</span>shoutbox_counter<span class="Identifier">]</span>);<span class="Identifier">}</span>
        <span class="Statement">else</span><span class="Identifier">{</span>
            shoutbox_counter = ma.length;
            $(<span class="Constant">'#tts'</span>).val(<span class="Constant">&quot;&quot;</span>);
        <span class="Identifier">}</span>
    <span class="Identifier">}</span>
    <span class="Statement">if</span> (a.keyCode == 38) <span class="Identifier">{</span>
        <span class="Statement">if</span> (shoutbox_counter &gt; 0)
            shoutbox_counter -= 1;
        $(<span class="Constant">'#tts'</span>).val(ma<span class="Identifier">[</span>shoutbox_counter<span class="Identifier">]</span>);
    <span class="Identifier">}</span>
    <span class="Statement">if</span> (a.keyCode == 13 &amp;&amp; $(<span class="Identifier">this</span>).val() != <span class="Constant">&quot;&quot;</span>) <span class="Identifier">{</span>

            chatmessage();


    <span class="Identifier">}</span>

<span class="Identifier">}</span>);


<span class="Comment">//Klikataan sendmsg nappia</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">'click'</span>,<span class="Constant">&quot;#sendmsg&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
    chatmessage();
<span class="Identifier">}</span>);

<span class="Comment">//Lisätään emoticon</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">'click'</span>,<span class="Constant">&quot;#addemoticon&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>

        <span class="Identifier">var</span> s = $(<span class="Constant">&quot;#addemoticon_sana&quot;</span>).val();
        <span class="Identifier">var</span> l = $(<span class="Constant">&quot;#addemoticon_linkki&quot;</span>).val();
        console.log(<span class="Constant">&quot;l = &quot;</span> + l);
        console.log(<span class="Constant">&quot;s = &quot;</span> + s);
      $.ajax(<span class="Identifier">{</span>
        type: <span class="Constant">'post'</span>,
        url: <span class="Constant">'emoticonssc.php'</span>,
        data: <span class="Identifier">{</span>dothis:0,sana:s,linkki:l<span class="Identifier">}</span>
      <span class="Identifier">}</span>);

    <span class="Identifier">}</span>);

<span class="Comment">//Lisää viestejä</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">'click'</span>,<span class="Constant">'#moreshouts'</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
    <span class="Identifier">var</span> rowcount = $(<span class="Constant">'#shoutbox table tbody tr'</span>).length;
    $.ajax(<span class="Identifier">{</span>
        type:<span class="Constant">'GET'</span>,
        url:<span class="Constant">'getshouts.php'</span>,
        data: <span class="Identifier">{</span>dothis:<span class="Constant">'getshouts'</span>,kohta:rowcount,rowcount:0<span class="Identifier">}</span>,
        success: <span class="Identifier">function</span> (data) <span class="Identifier">{</span>
            $(<span class="Constant">'#shoutbox table tbody tr:last-child'</span>).after(data);
        <span class="Identifier">}</span>
    <span class="Identifier">}</span>);
<span class="Identifier">}</span>);


<span class="Comment">/* </span>
<span class="Comment"> * SIDEBAR</span>
<span class="Comment"> */</span>


    <span class="Comment">//Youtube-linkki-alue enterpainallus</span>
    $(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">'keypress'</span>,<span class="Constant">'.youtube'</span>,<span class="Identifier">function</span>(e)<span class="Identifier">{</span>
        <span class="Statement">if</span> (e.keyCode == 13) <span class="Identifier">{</span>
            <span class="Identifier">var</span> v = $(<span class="Identifier">this</span>).val();
            v = v.replace(<span class="Constant">&quot;https&quot;</span>,<span class="Constant">&quot;http&quot;</span>);
            console.log(v);
            <span class="Identifier">var</span> $path = <span class="Identifier">{</span>yt:1, path:v<span class="Identifier">}</span>;
            $(<span class="Identifier">this</span>).val(<span class="Constant">&quot;&quot;</span>);
            $.ajax(<span class="Identifier">{</span>
                type: <span class="Constant">'POST'</span>,
                url: <span class="Constant">'playvlc.php'</span>,
                data: $path,
                success: <span class="Identifier">function</span>(data) <span class="Identifier">{</span>
                    console.log(data);
                <span class="Identifier">}</span>
            <span class="Identifier">}</span>);
        <span class="Identifier">}</span>
    <span class="Identifier">}</span>);


<span class="Comment">//Klikataan stop youtube -nappia</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">'click'</span>,<span class="Constant">'.stop_youtube'</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
    $.ajax(<span class="Identifier">{</span>
        type: <span class="Constant">'POST'</span>,
        url: <span class="Constant">'playvlc.php'</span>,
        data: <span class="Identifier">{</span>yt:0, path:<span class="Constant">&quot;stopyoutube&quot;</span><span class="Identifier">}</span>
      <span class="Identifier">}</span>);

<span class="Identifier">}</span>);

<span class="Comment">//Klikataan stop music-nappia</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;.stop&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
    $.ajax(<span class="Identifier">{</span>
        type: <span class="Constant">'POST'</span>,
        url: <span class="Constant">'playvlc.php'</span>,
        data: <span class="Identifier">{</span>yt:0, path:<span class="Constant">&quot;stop&quot;</span><span class="Identifier">}</span>
      <span class="Identifier">}</span>);

<span class="Identifier">}</span>);


<span class="Comment">//ts_chatin enterpainallus</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;keypress&quot;</span>,<span class="Constant">&quot;#ytchat_input&quot;</span>,<span class="Identifier">function</span>(e)<span class="Identifier">{</span>
        <span class="Statement">if</span> (e.keyCode == 13 &amp;&amp; $(<span class="Constant">'#ytchat_input'</span>).val() != <span class="Constant">&quot;&quot;</span>)<span class="Identifier">{</span>
            msg = $(<span class="Constant">'#ytchat_input'</span>).val();



            $.ajax(<span class="Identifier">{</span>
                type: <span class="Constant">'POST'</span>,
                url: <span class="Constant">'/dev/teamspeak/tschatmessage.php'</span>,
                data: <span class="Identifier">{</span>user:$(<span class="Constant">'#username'</span>).val(),msg:msg<span class="Identifier">}</span>,
                success:<span class="Identifier">function</span>(msg)<span class="Identifier">{</span>
                    console.log( <span class="Constant">'tschatmessage.php: '</span>);
                    console.log(msg);
                <span class="Identifier">}</span>
            <span class="Identifier">}</span>);
            $(<span class="Constant">'#ytchat_input'</span>).val(<span class="Constant">''</span>);
        <span class="Identifier">}</span>
    <span class="Identifier">}</span>);



<span class="Comment">//click youtubehide</span>
$(<span class="Constant">'body'</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;#hideyoutube&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
        <span class="Statement">if</span>($(<span class="Constant">&quot;#youtube&quot;</span>).length == 1) <span class="Identifier">{</span>
            $(<span class="Constant">'#youtube'</span>).remove();
            $.removeCookie(<span class="Constant">'yt_open'</span>);
        <span class="Identifier">}</span> <span class="Statement">else</span> <span class="Identifier">{</span>
            $(<span class="Identifier">this</span>).after(<span class="Constant">'&lt;div id=&quot;youtube&quot;&gt;&lt;/div&gt;'</span>)
            $.cookie(<span class="Constant">&quot;yt_open&quot;</span>, <span class="Constant">true</span>, <span class="Identifier">{</span> expires : 10 <span class="Identifier">}</span>);
            youtube_rowid = 0;
            longPoll(<span class="Constant">true</span>);
        <span class="Identifier">}</span>
    <span class="Identifier">}</span>);

<span class="Comment">//click youtube enlarge</span>
$(<span class="Constant">'body'</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;#enlargeyoutube&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
        <span class="Statement">if</span>($(<span class="Constant">&quot;#youtube&quot;</span>).css(<span class="Constant">'position'</span>) == <span class="Constant">&quot;absolute&quot;</span>) <span class="Identifier">{</span>
            $(<span class="Constant">'#youtube'</span>).css(<span class="Constant">'position'</span>,<span class="Constant">'static'</span>);
            $(<span class="Constant">'#youtube'</span>).css(<span class="Constant">'z-index'</span>,0);
            $(<span class="Constant">'#youtube'</span>).css(<span class="Constant">'width'</span>,<span class="Constant">''</span>);
            $(<span class="Constant">'#youtube'</span>).css(<span class="Constant">'height'</span>,<span class="Constant">''</span>);

        <span class="Identifier">}</span> <span class="Statement">else</span> <span class="Identifier">{</span>
            $(<span class="Constant">'#youtube'</span>).css(<span class="Constant">'height'</span>,<span class="Constant">'480px'</span>);
            $(<span class="Constant">'#youtube'</span>).css(<span class="Constant">'position'</span>,<span class="Constant">'absolute'</span>);
            $(<span class="Constant">'#youtube'</span>).css(<span class="Constant">'z-index'</span>,1);
            $(<span class="Constant">'#youtube'</span>).css(<span class="Constant">'width'</span>,<span class="Constant">'854px'</span>);
        <span class="Identifier">}</span>
    <span class="Identifier">}</span>);


<span class="Comment">/* </span>
<span class="Comment"> * RECORDINGS</span>
<span class="Comment"> */</span>


<span class="Comment">//Klikataan makedraggable-nappia</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">'click'</span>,<span class="Constant">'#makedraggable'</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
    makerecordingsdraggable();
    $(<span class="Identifier">this</span>).attr(<span class="Constant">&quot;disabled&quot;</span>,<span class="Constant">&quot;disabled&quot;</span>);
<span class="Identifier">}</span>);



<span class="Comment">//click new rcategory</span>
$(<span class="Constant">'body'</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;#newrcategory&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
    category = <span class="Statement">prompt</span>(<span class="Constant">&quot;Anna uuden kategorian nimi&quot;</span>);
    newdiv = $(<span class="Constant">'&lt;div&gt;'</span> + category + <span class="Constant">'&lt;p&gt;&lt;/div&gt;'</span>)
    newdiv.attr(<span class="Constant">'class'</span>,<span class="Constant">'rcategory'</span>);
    newdiv.attr(<span class="Constant">'value'</span>, category);
    newdiv.css(<span class="Constant">'min-height'</span>,77);
    newdiv.css(<span class="Constant">'min-width'</span>,100);
    newdiv.css(<span class="Constant">'max-width'</span>,<span class="Constant">'40%'</span>);
    newdiv.css(<span class="Constant">'border'</span>,<span class="Constant">'2px solid'</span>);
    newdiv.css(<span class="Constant">'margin'</span>,<span class="Constant">'10px'</span>);
    newdiv.css(<span class="Constant">'padding'</span>,<span class="Constant">'5px'</span>);
    newdiv.css(<span class="Constant">'float'</span>,<span class="Constant">'left'</span>);
    newdiv.droppable(<span class="Identifier">{</span>accept: <span class="Constant">&quot;.recording&quot;</span>,activeClass: <span class="Constant">&quot;ui-state-highlight&quot;</span>,
        drop: <span class="Identifier">function</span>( <span class="Statement">event</span>, ui ) <span class="Identifier">{</span>
            $(<span class="Identifier">this</span>).append(ui.draggable)
            console.log(ui.draggable.attr(<span class="Constant">'title'</span>))
            console.log($(<span class="Identifier">this</span>).attr(<span class="Constant">'value'</span>))

            $.ajax(<span class="Identifier">{</span>
                type: <span class="Constant">'POST'</span>,
                url: <span class="Constant">'moverecording.php'</span>,
                data: <span class="Identifier">{</span>rowid:ui.draggable.attr(<span class="Constant">'title'</span>),newcat:$(<span class="Identifier">this</span>).attr(<span class="Constant">'value'</span>)<span class="Identifier">}</span>
            <span class="Identifier">}</span>);
        <span class="Identifier">}}</span>)
    $(<span class="Constant">'#recordings'</span>).prepend(newdiv);
    <span class="Identifier">}</span>);


<span class="Comment">//right click on recording</span>
$(<span class="Constant">'body'</span>).on(<span class="Constant">&quot;contextmenu&quot;</span>,<span class="Constant">&quot;.recording&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
    <span class="Statement">if</span> ($(<span class="Constant">&quot;#modifyrecording&quot;</span>).length == 0) <span class="Identifier">{</span>

        oldwidth = $(<span class="Identifier">this</span>).width();

        $(<span class="Identifier">this</span>).after(<span class="Constant">'&lt;div id=&quot;modbox&quot;&gt;&lt;input id=&quot;modifyrecording&quot; size=&quot;7&quot; title=&quot;'</span> + $(<span class="Identifier">this</span>).html() + <span class="Constant">'&quot; value=&quot;'</span> + $(<span class="Identifier">this</span>).html() + <span class="Constant">'&quot;/&gt;'</span> +
        <span class="Constant">'&lt;button id=&quot;deleterecording&quot; style=&quot;padding:2px;min-width:20px;z-index:10;'</span> +
        <span class="Constant">'position: relative;left: 10px;top: -8px;margin-left: -2px;margin-top : 10px;&quot;&gt;x&lt;/button&gt;&lt;/div&gt;'</span>);

        $(<span class="Constant">&quot;#modbox&quot;</span>).css(<span class="Constant">'position'</span>, <span class="Constant">'absolute'</span>);
        $(<span class="Constant">&quot;#modbox&quot;</span>).css(<span class="Constant">'top'</span>, $(<span class="Identifier">this</span>).position()<span class="Identifier">[</span><span class="Constant">'top'</span><span class="Identifier">]</span>);
        $(<span class="Constant">&quot;#modbox&quot;</span>).css(<span class="Constant">'left'</span>, $(<span class="Identifier">this</span>).position()<span class="Identifier">[</span><span class="Constant">'left'</span><span class="Identifier">]</span>);
        $(<span class="Constant">&quot;#modbox&quot;</span>).css(<span class="Constant">&quot;z-index&quot;</span>,<span class="Constant">&quot;10&quot;</span>);

        $(<span class="Constant">&quot;#modifyrecording&quot;</span>).focus();
        $(<span class="Constant">&quot;#modifyrecording&quot;</span>).select();
        $(<span class="Identifier">this</span>).attr(<span class="Constant">&quot;disabled&quot;</span>,<span class="Constant">&quot;disabled&quot;</span>);
        $(<span class="Identifier">this</span>).css(<span class="Constant">&quot;position&quot;</span>,<span class="Constant">&quot;relative&quot;</span>);
        $(<span class="Identifier">this</span>).css(<span class="Constant">&quot;z-index&quot;</span>,<span class="Constant">&quot;1&quot;</span>);
    <span class="Identifier">}</span>
    <span class="Statement">return</span> <span class="Constant">false</span>;
<span class="Identifier">}</span>);



<span class="Comment">//Modifying a recording</span>
<span class="Identifier">var</span> modify_recording = <span class="Identifier">function</span>(element) <span class="Identifier">{</span>
    e_parent = $(element).<span class="Statement">parent</span>().prev();
    newname = $(element).val();
    oldname = $(element).attr(<span class="Constant">'title'</span>);
    rowid = e_parent.attr(<span class="Constant">'title'</span>);
    <span class="Statement">if</span> (newname !== oldname) <span class="Identifier">{</span>
        $.ajax(<span class="Identifier">{</span>
            type: <span class="Constant">'POST'</span>,
            url: <span class="Constant">'renamerecording.php'</span>,
            data: <span class="Identifier">{</span>rowid:rowid,newname:newname<span class="Identifier">}</span>
        <span class="Identifier">}</span>);

    <span class="Identifier">}</span>

    e_parent.removeAttr(<span class="Constant">&quot;disabled&quot;</span>);
    e_parent.html(newname);
    element.<span class="Statement">parent</span>().remove();
<span class="Identifier">}</span>
<span class="Comment">//recordingmuokkausalue</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;blur&quot;</span>,<span class="Constant">&quot;#modifyrecording&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
    setTimeout($.proxy(<span class="Identifier">function</span>() <span class="Identifier">{</span>
        modify_recording($(<span class="Identifier">this</span>));
    <span class="Identifier">}</span>,<span class="Identifier">this</span>),500);
<span class="Identifier">}</span>);
<span class="Comment">//recordingmuokkausalueen napinpainallus</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;keypress&quot;</span>,<span class="Constant">&quot;#modifyrecording&quot;</span>,<span class="Identifier">function</span>(e)<span class="Identifier">{</span>
        <span class="Statement">if</span> (e.keyCode == 13)<span class="Identifier">{</span>
            modify_recording($(<span class="Identifier">this</span>));
        <span class="Identifier">}</span>
    <span class="Identifier">}</span>);



<span class="Comment">//poista reconrding</span>
$(<span class="Constant">'body'</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;#deleterecording&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
        <span class="Comment">//if (confirm(&quot;Oletko varma, että haluat poistaa aanityksen?&quot;)) {</span>
            $.ajax(<span class="Identifier">{</span>
                type: <span class="Constant">'POST'</span>,
                url: <span class="Constant">'deleterecording.php'</span>,
                data: <span class="Identifier">{</span>rowid:$(<span class="Identifier">this</span>).<span class="Statement">parent</span>().prev().attr(<span class="Constant">'title'</span>)<span class="Identifier">}</span>
            <span class="Identifier">}</span>);
            recordings_revision += 1;
            $(<span class="Identifier">this</span>).<span class="Statement">parent</span>().prev().remove();
            $(<span class="Constant">'#modbox'</span>).remove();
        <span class="Comment">//}</span>

    <span class="Identifier">}</span>);

<span class="Comment">//Painetaan record-nappia (joka on enabloitu)</span>
$(<span class="Constant">'body'</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;.recordbutton&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
    $.ajax(<span class="Identifier">{</span>
        type: <span class="Constant">'POST'</span>,
        url: <span class="Constant">'playvlc.php'</span>,
        data: <span class="Identifier">{</span>yt:0, path:<span class="Constant">&quot;record&quot;</span><span class="Identifier">}</span>
      <span class="Identifier">}</span>);

<span class="Identifier">}</span>);


<span class="Comment">/* </span>
<span class="Comment"> * SOUNDBOARD</span>
<span class="Comment"> */</span>

<span class="Comment">//Piilota äänikategoria</span>
$(<span class="Constant">'body'</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;.hidecat&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
        $(<span class="Identifier">this</span>).next().children().toggle(<span class="Constant">'fast'</span>);

    <span class="Identifier">}</span>);

<span class="Comment">//Toista ääni</span>
$(<span class="Constant">'body'</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;.sbutton&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
        <span class="Statement">if</span> (!$(<span class="Identifier">this</span>).is(<span class="Constant">&quot;:disabled&quot;</span>)) <span class="Identifier">{</span>

            $.ajax(<span class="Identifier">{</span>
                type: <span class="Constant">'POST'</span>,
                url: <span class="Constant">'playvlc.php'</span>,
                data: <span class="Identifier">{</span>yt:0,
                path:$(<span class="Identifier">this</span>).val()<span class="Identifier">}</span>,
                success: <span class="Identifier">function</span>(data)<span class="Identifier">{</span>
                console.log(<span class="Constant">&quot;data: &quot;</span>+data);
                <span class="Identifier">}</span>
              <span class="Identifier">}</span>);
        <span class="Identifier">}</span>
    <span class="Identifier">}</span>);


<span class="Comment">/* </span>
<span class="Comment"> * VITSIT</span>
<span class="Comment"> */</span>
    <span class="Comment">//Lisätään vitsi</span>
    $(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">'keypress'</span>,<span class="Constant">'#addjoke'</span>,<span class="Identifier">function</span>(e)<span class="Identifier">{</span>
        <span class="Statement">if</span> (e.keyCode == 13) <span class="Identifier">{</span>
            <span class="Identifier">var</span> v = $(<span class="Identifier">this</span>).val();
            $.ajax(<span class="Identifier">{</span>
                type: <span class="Constant">'POST'</span>,
                url: <span class="Constant">'vitsisivusc.php'</span>,
                data: <span class="Identifier">{</span>kieli:<span class="Constant">'fi'</span>,vitsi:v,dothis:0<span class="Identifier">}</span>
            <span class="Identifier">}</span>);
            $(<span class="Identifier">this</span>).val(<span class="Constant">&quot;&quot;</span>);
        <span class="Identifier">}</span>
    <span class="Identifier">}</span>);

<span class="Comment">//Kerro vitsi</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">'#kerrovitsi'</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
    $.ajax(<span class="Identifier">{</span>
    data:<span class="Identifier">{</span>kieli:<span class="Constant">'fi'</span>,vitsi:<span class="Constant">'**random**'</span>,badumtss:1<span class="Identifier">}</span>,
    url:<span class="Constant">'tts.php'</span>,
    type:<span class="Constant">'POST'</span>,
    success: <span class="Identifier">function</span>(data)<span class="Identifier">{</span>
        console.log(data);
    <span class="Identifier">}}</span>);
<span class="Identifier">}</span>);


<span class="Comment">//Toista vitsi</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;.toista&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
    <span class="Identifier">var</span> kohde = $(<span class="Identifier">this</span>).<span class="Statement">parent</span>().prev();
    <span class="Identifier">var</span> v = kohde.html();
    console.log(kohde);
    $.ajax(<span class="Identifier">{</span>
        type: <span class="Constant">'POST'</span>,
        url: <span class="Constant">'tts.php'</span>,
        data: <span class="Identifier">{</span>kieli:<span class="Constant">&quot;fi&quot;</span>,badumtss:1,yt:0,vitsi:v<span class="Identifier">}</span>
    <span class="Identifier">}</span>);
<span class="Identifier">}</span>);


<span class="Comment">//Poista vitsi</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;.deletevitsi&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
        <span class="Identifier">var</span> id = $(<span class="Identifier">this</span>).<span class="Statement">parent</span>().attr(<span class="Constant">&quot;id&quot;</span>);
        console.log(id);
        <span class="Statement">if</span> (<span class="Statement">confirm</span>(<span class="Constant">&quot;Oletko varma, että haluat poistaa vitsin?&quot;</span>))
        deleteVitsi(id);
    <span class="Identifier">}</span>);
<span class="Comment">//Muokkaa vitsiä</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;.edit_button&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
        <span class="Identifier">var</span> kohde = $(<span class="Identifier">this</span>).<span class="Statement">parent</span>().prev().prev().prev();
        console.log(kohde.children())
        <span class="Statement">if</span> (kohde.children().is(<span class="Constant">&quot;input&quot;</span>)) <span class="Statement">return</span>;
        <span class="Identifier">var</span> v = kohde.html();
        console.log(kohde);

        kohde.html(<span class="Constant">'&lt;input type=&quot;text&quot; class=&quot;edit_area&quot; value=&quot;'</span>+
            v+<span class="Constant">'&quot; size=&quot;'</span>+(v.length*1.1)+<span class="Constant">'&quot;&gt;'</span>);
        updating = <span class="Constant">false</span>;
        kohde.children(<span class="Constant">&quot;input&quot;</span>).focus();

    <span class="Identifier">}</span>);
<span class="Comment">//Vitsinmuokkausalue</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;blur&quot;</span>,<span class="Constant">&quot;.edit_area&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
        <span class="Identifier">var</span> id = $(<span class="Identifier">this</span>).<span class="Statement">parent</span>().<span class="Statement">parent</span>().attr(<span class="Constant">&quot;id&quot;</span>);
    <span class="Identifier">var</span> v = $(<span class="Identifier">this</span>).val();
    $(<span class="Constant">&quot;#edit_area&quot;</span>).replaceWith(v);
    editVitsi(id,v)

<span class="Identifier">}</span>);
<span class="Comment">//Vitsinmuokkausalueen napinpainallus</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;keypress&quot;</span>,<span class="Constant">&quot;.edit_area&quot;</span>,<span class="Identifier">function</span>(e)<span class="Identifier">{</span>
        <span class="Statement">if</span> (e.keyCode == 13)<span class="Identifier">{</span>
            <span class="Identifier">var</span> id = $(<span class="Identifier">this</span>).<span class="Statement">parent</span>().<span class="Statement">parent</span>().attr(<span class="Constant">&quot;id&quot;</span>);
            <span class="Identifier">var</span> v = $(<span class="Identifier">this</span>).val();
            editVitsi(id,v)
        <span class="Identifier">}</span>
    <span class="Identifier">}</span>);


<span class="Comment">/* </span>
<span class="Comment"> * EMOTICONS</span>
<span class="Comment"> */</span>


<span class="Comment">//Poista hymiö</span>
$(<span class="Constant">'body'</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;.deleteemo&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
            <span class="Statement">if</span> (<span class="Statement">confirm</span>(<span class="Constant">&quot;Oletko varma, että haluat poistaa hymiön?&quot;</span>)) <span class="Identifier">{</span>
                <span class="Identifier">var</span> s = $(<span class="Identifier">this</span>).next().html();
                console.log(s);
                $.ajax(<span class="Identifier">{</span>
                    type: <span class="Constant">'post'</span>,
                    url: <span class="Constant">'emoticonssc.php'</span>,
                    data: <span class="Identifier">{</span>dothis:1,sana:s<span class="Identifier">}</span>
                <span class="Identifier">}</span>);
            <span class="Identifier">}</span>
        <span class="Identifier">}</span>);


<span class="Comment">//Klikkaa hymiötä</span>
$(<span class="Constant">'body'</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;img.emoticon&quot;</span>,<span class="Identifier">function</span>(e)<span class="Identifier">{</span>
        <span class="Statement">if</span> ($(<span class="Constant">'#tts'</span>).val() == $(<span class="Constant">'#tts'</span>).attr(<span class="Constant">'alt'</span>))
            $(<span class="Constant">'#tts'</span>).val(<span class="Constant">&quot;&quot;</span>);
    $(<span class="Constant">'#tts'</span>).val($(<span class="Constant">'#tts'</span>).val() + $(<span class="Identifier">this</span>).attr(<span class="Constant">'alt'</span>));
    $(<span class="Constant">'#tts'</span>).focus();
<span class="Identifier">}</span>);
<span class="Comment">//Piilota hymiot</span>
$(<span class="Constant">'body'</span>).on(<span class="Constant">&quot;click&quot;</span>,<span class="Constant">&quot;#hideemos&quot;</span>,<span class="Identifier">function</span>()<span class="Identifier">{</span>
        $(<span class="Constant">'#emoticons'</span>).toggle()
    <span class="Identifier">}</span>);










<span class="Comment">//DOCUMENT READY ALKAA</span>
$(<span class="Statement">document</span>).ready(<span class="Identifier">function</span>()<span class="Identifier">{</span>
    disablejukebox();

    <span class="Comment">//Alustaa välilehdet</span>
    $( <span class="Constant">&quot;#tabs&quot;</span> ).tabs(<span class="Identifier">{</span>activate: <span class="Identifier">function</span>( <span class="Statement">event</span>, ui )<span class="Identifier">{</span>
        console.log(ui.newTab.index());
        <span class="Statement">if</span> (ui.newTab.index() === 2) <span class="Identifier">{</span>
            <span class="Comment">//recordings_revision = -1;</span>
            <span class="Comment">//longPoll(true);</span>
        <span class="Identifier">}</span>
    <span class="Identifier">}}</span>);
    <span class="Statement">if</span> (mobile) <span class="Identifier">{</span>
        $(<span class="Constant">&quot;#teamspeak&quot;</span>).remove();
        $(<span class="Constant">&quot;#teamspeak2&quot;</span>).attr(<span class="Constant">&quot;id&quot;</span>,<span class="Constant">&quot;teamspeak&quot;</span>);
        $(<span class="Constant">&quot;div.ui-tabs-panel&quot;</span>).css(<span class="Constant">'padding'</span>,<span class="Constant">'0px'</span>);
    <span class="Identifier">}</span> <span class="Statement">else</span> <span class="Identifier">{</span>

        $( <span class="Constant">&quot;#tabs&quot;</span> ).tabs( <span class="Constant">&quot;disable&quot;</span>, 6 );

    <span class="Identifier">}</span>

    <span class="Comment">//Kekseistä haetaan nimi, väri ja viestihistoria</span>
    $.cookie.json = <span class="Constant">true</span>;

    <span class="Statement">if</span>($.cookie(<span class="Constant">&quot;yt_open&quot;</span>) != <span class="Statement">undefined</span>)
        $(<span class="Constant">&quot;#hideyoutube&quot;</span>).after(<span class="Constant">'&lt;div id=&quot;youtube&quot;&gt;&lt;/div&gt;'</span>)


    <span class="Statement">if</span> ($.cookie(<span class="Constant">&quot;shoutname&quot;</span>) != <span class="Statement">undefined</span>)
        $(<span class="Constant">'#username'</span>).val($.cookie(<span class="Constant">&quot;shoutname&quot;</span>));


    <span class="Statement">if</span> ($.cookie(<span class="Constant">&quot;usercolor&quot;</span>) != <span class="Statement">undefined</span>)
        $(<span class="Constant">'#usercolor'</span>).val($.cookie(<span class="Constant">&quot;usercolor&quot;</span>));

    <span class="Statement">if</span> ($.cookie(<span class="Constant">&quot;session&quot;</span>) != <span class="Statement">undefined</span>)
        session = $.cookie(<span class="Constant">&quot;session&quot;</span>);
    <span class="Statement">else</span> <span class="Identifier">{</span>
        session = $.now().toString() + $(<span class="Constant">'#username'</span>).val();
        $.cookie(<span class="Constant">&quot;session&quot;</span>, session, <span class="Identifier">{</span> expires : 10 <span class="Identifier">}</span>);
        <span class="Identifier">}</span>

    ma = <span class="Identifier">[]</span>;
    <span class="Statement">if</span> ($.cookie(<span class="Constant">&quot;sentmessages&quot;</span>) != <span class="Statement">undefined</span>)
    ma = JSON.parse($.cookie(<span class="Constant">&quot;sentmessages&quot;</span>));

    shoutbox_counter = ma.length;

    <span class="Comment">//ilmoitusvilkutus</span>
    setInterval(<span class="Identifier">function</span> () <span class="Identifier">{</span>
        <span class="Statement">if</span> (happening)<span class="Identifier">{</span>
            <span class="Statement">if</span> (vilkku)<span class="Identifier">{</span>
                <span class="Statement">document</span>.title = <span class="Constant">&quot;Koppislandia&quot;</span>;
            <span class="Identifier">}</span><span class="Statement">else</span><span class="Identifier">{</span>
                <span class="Statement">document</span>.title = <span class="Constant">&quot;**Uusi viesti!**&quot;</span>;
            <span class="Identifier">}</span>
            vilkku = !vilkku;
        <span class="Identifier">}</span>
    <span class="Identifier">}</span>, 1000);



    updateTJt();
    longPoll();

    $(<span class="Constant">'body'</span>).show();
<span class="Identifier">}</span>);



<span class="Identifier">function</span> addslashes(string) <span class="Identifier">{</span>
    <span class="Statement">return</span> string.replace(/<span class="Identifier">\\</span>/g, <span class="Constant">'</span><span class="Special">\\\\</span><span class="Constant">'</span>).
        replace(<span class="Constant">/\u0008/g</span>, <span class="Constant">'</span><span class="Special">\\</span><span class="Constant">b'</span>).
        replace(<span class="Constant">/\t/g</span>, <span class="Constant">'</span><span class="Special">\\</span><span class="Constant">t'</span>).
        replace(<span class="Constant">/\n/g</span>, <span class="Constant">'</span><span class="Special">\\</span><span class="Constant">n'</span>).
        replace(<span class="Constant">/\f/g</span>, <span class="Constant">'</span><span class="Special">\\</span><span class="Constant">f'</span>).
        replace(<span class="Constant">/\r/g</span>, <span class="Constant">'</span><span class="Special">\\</span><span class="Constant">r'</span>).
        replace(<span class="Constant">/'/g</span>, <span class="Constant">'</span><span class="Special">\\\'</span><span class="Constant">'</span>).
        replace(<span class="Constant">/&quot;/g</span>, <span class="Constant">'</span><span class="Special">\\</span><span class="Constant">&quot;'</span>);
<span class="Identifier">}</span>




<span class="Identifier">function</span> postmessage(usr,msg,kieli,tts)<span class="Identifier">{</span>
    <span class="Comment">//hommataan DateTime-muodossa aika</span>
    <span class="Identifier">var</span> currentdate = <span class="Statement">new</span> <span class="Type">Date</span>();
    <span class="Identifier">var</span> realdate = currentdate.toString().match(<span class="Constant">/\d\d:\d\d:\d\d/</span>);
    <span class="Identifier">var</span> datetime = currentdate.toISOString().match(<span class="Constant">/\d\d\d\d-\d\d-\d\d/</span>);
    datetime += <span class="Constant">&quot; &quot;</span>+realdate;



    <span class="Comment">//nimi keksiin</span>
    $.cookie(<span class="Constant">&quot;shoutname&quot;</span>, usr, <span class="Identifier">{</span> expires : 10 <span class="Identifier">}</span>);
    <span class="Comment">//Jos pitää puhua laitetaan tts.phplle</span>
    <span class="Statement">if</span> (tts)<span class="Identifier">{</span>
    <span class="Identifier">var</span> $data = <span class="Identifier">{</span>kieli:kieli,badumtss:0,yt:0,
    vitsi:msg.replace(<span class="Constant">/&lt;a href=.*&gt;(.*)&lt;\/a&gt;/g</span>, <span class="Constant">&quot;$1&quot;</span>)<span class="Identifier">}</span>;
    $.ajax(<span class="Identifier">{</span>
        type: <span class="Constant">'POST'</span>,
        url: <span class="Constant">'tts.php'</span>,
        data: $data
    <span class="Identifier">}</span>);
    <span class="Identifier">}</span>

    $.ajax(<span class="Identifier">{</span>
        type: <span class="Constant">'POST'</span>,
        url: <span class="Constant">'shout.php'</span>,
        data: <span class="Identifier">{</span>
            date:datetime,
            user:usr,
            msg:msg<span class="Identifier">}</span>
    <span class="Identifier">}</span>);
    <span class="Statement">if</span> (mobile)<span class="Identifier">{</span>
        longPoll(<span class="Constant">true</span>);
    <span class="Identifier">}</span>
<span class="Identifier">}</span>


<span class="Identifier">function</span> longPoll(loop)<span class="Identifier">{</span>
    console.log(<span class="Constant">&quot;starting stream! session = &quot;</span>+session);
    known_users = <span class="Identifier">[]</span>;

    $(<span class="Constant">&quot;#users span&quot;</span>).each(<span class="Identifier">function</span>() <span class="Identifier">{</span> known_users.push($(<span class="Identifier">this</span>).text()) <span class="Identifier">}</span>);
    console.log(JSON.stringify(known_users));
    $.ajax(<span class="Identifier">{</span>
        data:<span class="Identifier">{</span>
        rowid:$(<span class="Constant">&quot;#shoutbox table tbody tr:first-child&quot;</span>).attr(<span class="Constant">&quot;id&quot;</span>),
        kohta:0,
        user:$(<span class="Constant">'#username'</span>).val(),
        users:JSON.stringify(known_users),
        rec:recording,
        online:online,
        vitsit_revision:vitsit_revision,
        emoticons_revision:emoticons_revision,
        recordings_revision:recordings_revision,
        teamspeak_revision:teamspeak_revision,
        youtube_rowid:youtube_rowid,
        cookie_rowid:cookie_rowid,
        teamspeak_chat_rowid:teamspeak_chat_rowid,
        session_id:session<span class="Identifier">}</span>,
        type:<span class="Constant">'GET'</span>,
        url: <span class="Constant">'shoutstream.php'</span>,
        dataType:<span class="Constant">'json'</span>,
        timeout:ajaxtimeout,
        success:
    <span class="Identifier">function</span>(payload)<span class="Identifier">{</span>
        start_time = <span class="Statement">new</span> <span class="Type">Date</span>().getTime();
        <span class="Comment">//console.log('longpoll success!' + payload.debug);</span>
        <span class="Comment">//console.log(&quot;recording: &quot; + payload.rec);</span>
        <span class="Statement">if</span> (payload.<span class="Statement">status</span> == <span class="Constant">&quot;results&quot;</span> || payload.<span class="Statement">status</span> == <span class="Constant">&quot;no-results&quot;</span>)<span class="Identifier">{</span>
            <span class="Statement">if</span> (payload.<span class="Statement">status</span> == <span class="Constant">&quot;results&quot;</span>)<span class="Identifier">{</span>
                <span class="Comment">//console.log(JSON.stringify(payload));</span>
                console.log(payload);
            <span class="Statement">if</span> (payload.messages != <span class="Statement">null</span> &amp;&amp; payload.messages.length &gt; 0)<span class="Identifier">{</span>
            $.each(payload.messages, <span class="Identifier">function</span>(i, msg)<span class="Identifier">{</span>
                $(<span class="Constant">&quot;#shoutbox table tbody&quot;</span>).prepend(
                    <span class="Constant">'&lt;tr id=&quot;'</span> + msg.rowid + <span class="Constant">'&quot;&gt;'</span> +
                    <span class="Constant">'&lt;td&gt;'</span> + msg.time + <span class="Constant">'&lt;/td&gt;'</span> +
                    <span class="Constant">'&lt;td&gt;&lt;span class=&quot;username '</span> +
                        msg.user + <span class="Constant">'&quot; style=&quot;color:'</span>+
                        msg.color + <span class="Constant">'&quot;&gt;'</span> + msg.user +
                    <span class="Constant">'&lt;/td&gt;'</span> +
                    <span class="Constant">'&lt;td&gt;'</span> + msg.msg + <span class="Constant">'&lt;/td&gt;'</span> +
                    <span class="Constant">'&lt;/tr&gt;'</span>
                    );
                $(<span class="Constant">&quot;#shoutbox table tbody tr:nth-child(50)&quot;</span>).remove()

                <span class="Comment">//Vilkkuminen</span>
                <span class="Statement">if</span> (focusvar == 0)<span class="Identifier">{</span>happening = <span class="Constant">true</span>;<span class="Identifier">}</span>
            <span class="Identifier">}</span>);
            <span class="Identifier">}</span>
            <span class="Statement">if</span> (payload.users != <span class="Statement">null</span> &amp;&amp; payload.users.length &gt; 0)<span class="Identifier">{</span>
                $(<span class="Constant">&quot;#users&quot;</span>).html(<span class="Constant">&quot;Paikalla: &quot;</span>);
            $.each(payload.users, <span class="Identifier">function</span>(i, user)<span class="Identifier">{</span>
                $(<span class="Constant">&quot;#users&quot;</span>).append(<span class="Constant">'&lt;span&gt;'</span>+user+<span class="Constant">'&lt;/span&gt;   '</span>);
            <span class="Identifier">}</span>);
            <span class="Identifier">}</span>
                <span class="Statement">if</span> (payload.rec != <span class="Statement">null</span>)<span class="Identifier">{</span>
                    recording = payload.rec;
                    <span class="Statement">if</span> (recording == 1) <span class="Identifier">{</span>
                        $(<span class="Constant">'#recordbutton'</span>).css(<span class="Constant">'color'</span>, <span class="Constant">'red'</span>);
                        $(<span class="Constant">'#recordbutton'</span>).text(<span class="Constant">&quot;*Recording*&quot;</span>);
                        <span class="Comment">//disable record button</span>
                        $(<span class="Constant">'#recordbutton'</span>).attr(<span class="Constant">&quot;disabled&quot;</span>,<span class="Constant">&quot;disabled&quot;</span>);
                        $(<span class="Constant">'#recordbutton'</span>).removeClass(<span class="Constant">&quot;recordbutton&quot;</span>);
                        <span class="Comment">//disable play recorded-button                  </span>
                    <span class="Identifier">}</span> <span class="Statement">else</span> <span class="Identifier">{</span>
                        $(<span class="Constant">'#recordbutton'</span>).css(<span class="Constant">'color'</span>, <span class="Constant">'black'</span>);
                        $(<span class="Constant">'#recordbutton'</span>).text(<span class="Constant">&quot;Record&quot;</span>);
                        <span class="Comment">//enable buttons</span>
                        $(<span class="Constant">'#recordbutton'</span>).removeAttr(<span class="Constant">&quot;disabled&quot;</span>);
                        $(<span class="Constant">'#recordbutton'</span>).addClass(<span class="Constant">&quot;recordbutton&quot;</span>);
                    <span class="Identifier">}</span>
                    console.log(<span class="Constant">&quot;recording: &quot;</span> + recording);
                <span class="Identifier">}</span>

                <span class="Statement">if</span> (payload.vitsit != <span class="Statement">null</span>) <span class="Identifier">{</span>
                    vitsit_revision = payload.vitsit.pop();
                    $(<span class="Constant">'#vitsit'</span>).html(<span class="Constant">'&lt;ul&gt;&lt;/ul&gt;'</span>);
                    $.each(payload.vitsit, <span class="Identifier">function</span> (i, vitsi)<span class="Identifier">{</span>
                        $(<span class="Constant">'#vitsit ul'</span>).html($(<span class="Constant">'#vitsit ul'</span>).html() +
                            <span class="Constant">'&lt;li id=&quot;'</span>+
                            vitsi.rowid+
                            <span class="Constant">'&quot;&gt;&lt;button style=&quot;padding:2px;min-width:40px;&quot; class=&quot;deletevitsi&quot;&gt;X&lt;/button&gt;'</span> +
                            vitsi.vitsi +
                            <span class="Constant">'&lt;/li&gt;'</span>);
                    <span class="Identifier">}</span>)

                <span class="Identifier">}</span>
                <span class="Statement">if</span> (payload.emoticons != <span class="Statement">null</span>) <span class="Identifier">{</span>
                    emoticons_revision = payload.emoticons.pop();
                    console.log(emoticons_revision);
                    $(<span class="Constant">'#emoticons_tab'</span>).html(<span class="Constant">'&lt;ul&gt;&lt;/ul&gt;'</span>);
                    $(<span class="Constant">'#emoticons'</span>).html(<span class="Constant">''</span>);
                    $.each(payload.emoticons, <span class="Identifier">function</span> (i, emo)<span class="Identifier">{</span>
                        $(<span class="Constant">'#emoticons'</span>).html($(<span class="Constant">'#emoticons'</span>).html() +
                        <span class="Constant">'&lt;img style=&quot;max-width:50px;max-height:50px&quot;src=&quot;'</span>+emo.linkki+<span class="Constant">'&quot; alt=&quot;'</span>+emo.sana+<span class="Constant">'&quot; class=&quot;emoticon&quot;/&gt;'</span>);

                        $(<span class="Constant">'#emoticons_tab ul'</span>).html($(<span class="Constant">'#emoticons_tab ul'</span>).html() +
                            <span class="Constant">'&lt;li&gt;'</span>+
                            <span class="Constant">'&lt;button style=&quot;padding:2px;min-width:40px;&quot; class=&quot;deleteemo&quot;&gt;X&lt;/button&gt;'</span>+
                            <span class="Constant">'&lt;span&gt;'</span> + emo.sana + <span class="Constant">'&lt;/span&gt; -- '</span> +
                            <span class="Constant">'&lt;img style=&quot;max-width:50px;max-height:50px&quot;src=&quot;'</span>+
                            emo.linkki+<span class="Constant">'&quot;/&gt;&lt;/li&gt;'</span>);
                    <span class="Identifier">}</span>)

                <span class="Identifier">}</span>
                <span class="Statement">if</span> (payload.recordings != <span class="Statement">null</span>
                        &amp;&amp; parseInt(payload.recordings<span class="Identifier">[</span>payload.recordings.length - 1<span class="Identifier">]</span>) != recordings_revision)<span class="Identifier">{</span>

                    <span class="Statement">if</span> (payload.recordings.justone != <span class="Statement">null</span>) <span class="Identifier">{</span>

                        <span class="Statement">if</span> ($(<span class="Constant">'.recording[title=&quot;'</span>+payload.recordings.rowid+<span class="Constant">'&quot;]'</span>).length == 0 &amp;&amp;
                        payload.recordings.deleted !== 1 &amp;&amp; payload.recordings.deleted !== <span class="Constant">&quot;1&quot;</span>) <span class="Identifier">{</span>


                            name = payload.recordings.name
                            <span class="Statement">if</span> (payload.recordings.name == <span class="Statement">null</span> || payload.recordings.name == <span class="Constant">'1'</span>)
                                name = payload.recordings.rowid;


                            newbutton = $(<span class="Constant">'&lt;button'</span> +
                            <span class="Constant">' class=&quot;sbutton recording&quot; title=&quot;'</span>+payload.recordings.rowid+
                            <span class="Constant">'&quot; value=&quot;sounds</span><span class="Special">\\</span><span class="Constant">recorded</span><span class="Special">\\</span><span class="Constant">'</span> + (payload.recordings.rowid) + <span class="Constant">'.wav&quot;&gt;'</span> + (name) + <span class="Constant">'&lt;/button&gt;'</span>);

                            $($(<span class="Constant">&quot;#recordings&quot;</span>).children(<span class="Constant">&quot;.recording&quot;</span>)<span class="Identifier">[</span>0<span class="Identifier">]</span>).before(newbutton)

                            $(newbutton).draggable(<span class="Identifier">{</span>cancel: <span class="Constant">&quot;none&quot;</span>,stack:<span class="Constant">'.recording'</span>,helper: <span class="Constant">&quot;clone&quot;</span>,
                                scroll : <span class="Constant">false</span> ,distance: 50,
                                <span class="Constant">&quot;revert&quot;</span>: <span class="Identifier">function</span>(a) <span class="Identifier">{</span>

                                    <span class="Statement">if</span> (a == <span class="Constant">false</span>) <span class="Identifier">{</span>
                                        $.ajax(<span class="Identifier">{</span>
                                            type: <span class="Constant">'POST'</span>,
                                            url: <span class="Constant">'moverecording.php'</span>,
                                            data: <span class="Identifier">{</span>rowid:$(<span class="Identifier">this</span>).attr(<span class="Constant">'title'</span>),newcat:<span class="Constant">'null'</span><span class="Identifier">}</span>
                                        <span class="Identifier">}</span>);
                                        recordings_revision += 1;
                                        $.each($(<span class="Constant">&quot;#recordings .recording&quot;</span>), <span class="Identifier">function</span>(i, element) <span class="Identifier">{</span>
                                            <span class="Statement">if</span> (parseInt($(<span class="Identifier">this</span>).attr(<span class="Constant">&quot;title&quot;</span>)) &gt; parseInt($(element).attr(<span class="Constant">&quot;title&quot;</span>))) <span class="Identifier">{</span>
                                                $(element).before($(<span class="Identifier">this</span>));
                                                <span class="Statement">return</span> <span class="Constant">false</span>;
                                            <span class="Identifier">}</span>
                                        <span class="Identifier">}</span>)
                                    <span class="Identifier">}</span>
                                <span class="Identifier">}}</span>);
                        <span class="Identifier">}</span>

                        recordings_revision = payload.recordings.revision;

                        <span class="Identifier">var</span> rec = $(<span class="Constant">'#recordings[title=&quot;'</span> + payload.recordings.rowid + <span class="Constant">'&quot;]'</span>);
                        $(rec).html(payload.recordings.name);

                        <span class="Statement">if</span> (payload.recordings.deleted == 1 || payload.recordings.deleted == <span class="Constant">&quot;1&quot;</span>)
                            $(rec).remove();
                        <span class="Statement">if</span> (payload.recordings.category != <span class="Statement">null</span>) <span class="Identifier">{</span>
                            $.each($(<span class="Constant">'.rcategory[value=&quot;'</span> + payload.recordings.category + <span class="Constant">'&quot;] .recording'</span>), <span class="Identifier">function</span>(i, element) <span class="Identifier">{</span>
                                <span class="Statement">if</span> (parseInt($(rec).attr(<span class="Constant">&quot;title&quot;</span>)) &gt; parseInt($(element).attr(<span class="Constant">&quot;title&quot;</span>))) <span class="Identifier">{</span>
                                    $(element).before(rec);
                                    <span class="Statement">return</span> <span class="Constant">false</span>;
                                <span class="Identifier">}</span>
                            <span class="Identifier">}</span>)
                        <span class="Identifier">}</span> <span class="Statement">else</span> <span class="Identifier">{</span>
                            $.each($(<span class="Constant">'#recordings &gt; .recording'</span>), <span class="Identifier">function</span>(i, element) <span class="Identifier">{</span>
                                <span class="Statement">if</span> (parseInt($(rec).attr(<span class="Constant">&quot;title&quot;</span>)) &gt; parseInt($(element).attr(<span class="Constant">&quot;title&quot;</span>))) <span class="Identifier">{</span>
                                    $(element).before(rec);
                                    <span class="Statement">return</span> <span class="Constant">false</span>;
                                <span class="Identifier">}</span>
                            <span class="Identifier">}</span>)

                        <span class="Identifier">}</span>


                    <span class="Identifier">}</span> <span class="Statement">else</span> <span class="Identifier">{</span>

                    recordings_revision = parseInt(payload.recordings.pop());

                    $(<span class="Constant">'#recordings'</span>).html(<span class="Constant">''</span>);

                    $(<span class="Constant">'#recordings'</span>).append(<span class="Constant">'&lt;div id=&quot;rcat_1&quot; style=&quot;float:left;width:50%;&quot; &gt;&lt;/div&gt;'</span>);
                    $(<span class="Constant">'#recordings'</span>).append(<span class="Constant">'&lt;div id=&quot;rcat_2&quot; style=&quot;float:left;width:50%;&quot; &gt;&lt;/div&gt;'</span>);

                    $(<span class="Constant">'#recordings'</span>).append(<span class="Constant">'&lt;br style=&quot;clear:both&quot; /&gt;'</span>);

                    biggest = 0;
                    rec_playcounts = <span class="Identifier">[]</span>;
                    console.log(<span class="Constant">&quot;line 816: &quot;</span>+(<span class="Statement">new</span> <span class="Type">Date</span>().getTime()-start_time)+<span class="Constant">&quot;ms&quot;</span>);

                    cats = <span class="Identifier">{}</span>;
                        $.each($(<span class="Constant">'.rcategory'</span>),<span class="Identifier">function</span>()<span class="Identifier">{</span>
                            cats<span class="Identifier">[</span>$(<span class="Identifier">this</span>).attr(<span class="Constant">'value'</span>)<span class="Identifier">]</span> = $(<span class="Identifier">this</span>);
                    <span class="Identifier">}</span>)

                    $.each(payload.recordings.reverse(), <span class="Identifier">function</span>(i, rec) <span class="Identifier">{</span>


                        rec_playcounts<span class="Identifier">[</span>parseInt(rec.rowid)<span class="Identifier">]</span> = (parseInt(rec.playcount));
                        <span class="Statement">if</span> (rec.playcount &gt; biggest)
                            biggest = rec.playcount;

                        <span class="Statement">if</span> (rec.category != <span class="Statement">null</span> &amp;&amp; rec.category != <span class="Constant">&quot;null&quot;</span>) <span class="Identifier">{</span>
                            <span class="Statement">if</span> (!(rec.category <span class="Statement">in</span> cats)) <span class="Identifier">{</span><span class="Comment">//$('.rcategory[value=&quot;' + rec.category + '&quot;]').length == 0) {</span>


                                newdiv = $(<span class="Constant">'&lt;div&gt;'</span> + rec.category + <span class="Constant">'&lt;p&gt;&lt;/div&gt;'</span>)
                                newdiv.attr(<span class="Constant">'class'</span>,<span class="Constant">'rcategory'</span>);
                                newdiv.attr(<span class="Constant">'value'</span>, rec.category);
                                newdiv.css(<span class="Constant">'min-height'</span>,77);
                                newdiv.css(<span class="Constant">'min-width'</span>,100);
                                <span class="Comment">//newdiv.css('max-width','40%');</span>
                                newdiv.css(<span class="Constant">'border'</span>,<span class="Constant">'2px solid'</span>);
                                newdiv.css(<span class="Constant">'margin'</span>,<span class="Constant">'10px'</span>);
                                newdiv.css(<span class="Constant">'padding'</span>,<span class="Constant">'5px'</span>);
                                <span class="Comment">//newdiv.css('float','top');</span>
                                newdiv.droppable(<span class="Identifier">{</span>accept: <span class="Constant">&quot;.recording&quot;</span>,activeClass: <span class="Constant">&quot;ui-state-highlight&quot;</span>,
                                        drop: <span class="Identifier">function</span>( <span class="Statement">event</span>, ui ) <span class="Identifier">{</span>

                                            $.each($(<span class="Identifier">this</span>).children(), <span class="Identifier">function</span>(i, element) <span class="Identifier">{</span>
                                                <span class="Statement">if</span> (parseInt($(ui.draggable).attr(<span class="Constant">&quot;title&quot;</span>)) &gt; parseInt($(element).attr(<span class="Constant">&quot;title&quot;</span>))) <span class="Identifier">{</span>
                                                    $(element).before(ui.draggable);
                                                    <span class="Statement">return</span> <span class="Constant">false</span>;
                                                <span class="Identifier">}</span>
                                            <span class="Identifier">}</span>)
                                            recordings_revision += 1;
                                            $.ajax(<span class="Identifier">{</span>
                                                type: <span class="Constant">'POST'</span>,
                                                url: <span class="Constant">'moverecording.php'</span>,
                                                data: <span class="Identifier">{</span>rowid:ui.draggable.attr(<span class="Constant">'title'</span>),newcat:$(<span class="Identifier">this</span>).attr(<span class="Constant">'value'</span>)<span class="Identifier">}</span>
                                            <span class="Identifier">}</span>);

                                        <span class="Identifier">}}</span>)
                                $(<span class="Constant">'#recordings'</span>).prepend(newdiv);
                                cats<span class="Identifier">[</span>rec.category<span class="Identifier">]</span> = newdiv;

                            <span class="Identifier">}</span>
                        <span class="Identifier">}</span>
                    <span class="Identifier">}</span>)
                    console.log(<span class="Constant">&quot;line 867: &quot;</span>+(<span class="Statement">new</span> <span class="Type">Date</span>().getTime()-start_time)+<span class="Constant">&quot;ms&quot;</span>);
                    prevdate = <span class="Constant">&quot;&quot;</span>;




                    $.each(payload.recordings.reverse(), <span class="Identifier">function</span>(i, rec) <span class="Identifier">{</span>

                        name = rec.name
                        <span class="Statement">if</span> (rec.name == <span class="Statement">null</span> || rec.name == <span class="Constant">'1'</span>)
                            name = rec.rowid;



                        newbutton = $(<span class="Constant">'&lt;button'</span> +
                        <span class="Constant">' class=&quot;sbutton recording&quot; title=&quot;'</span>+rec.rowid+
                        <span class="Constant">'&quot; value=&quot;sounds</span><span class="Special">\\</span><span class="Constant">recorded</span><span class="Special">\\</span><span class="Constant">'</span> + (rec.rowid) + <span class="Constant">'.wav&quot;&gt;'</span> + (name) + <span class="Constant">'&lt;/button&gt;'</span>);



                        <span class="Statement">if</span> (rec.category != <span class="Statement">null</span> &amp;&amp; rec.category != <span class="Constant">&quot;null&quot;</span>) <span class="Identifier">{</span>
                            <span class="Comment">//$('.rcategory[value=&quot;' + rec.category + '&quot;]').append(newbutton);</span>
                            cats<span class="Identifier">[</span>rec.category<span class="Identifier">]</span>.append(newbutton);
                        <span class="Identifier">}</span> <span class="Statement">else</span> <span class="Identifier">{</span>
                            <span class="Statement">if</span> (rec.date !== prevdate) <span class="Identifier">{</span>
                                $(<span class="Constant">'#recordings'</span>).append(<span class="Constant">&quot;&lt;br&gt;&quot;</span> + rec.date + <span class="Constant">&quot;&lt;br&gt;&quot;</span>);
                            <span class="Identifier">}</span>
                            prevdate = rec.date;
                            $(<span class="Constant">'#recordings'</span>).append(newbutton);
                        <span class="Identifier">}</span>

                    <span class="Identifier">}</span>)


                    console.log(<span class="Constant">&quot;line 884: &quot;</span>+(<span class="Statement">new</span> <span class="Type">Date</span>().getTime()-start_time)+<span class="Constant">&quot;ms&quot;</span>);


                    $(<span class="Constant">'.rcategory'</span>).each(<span class="Identifier">function</span>() <span class="Identifier">{</span>
                        <span class="Statement">if</span> ($(<span class="Constant">'#rcat_1 .sbutton'</span>).length &lt; $(<span class="Constant">'#rcat_2 .sbutton'</span>).length)
                            $(<span class="Constant">'#rcat_1'</span>).prepend($(<span class="Identifier">this</span>));
                        <span class="Statement">else</span>
                            $(<span class="Constant">'#rcat_2'</span>).prepend($(<span class="Identifier">this</span>));
                    <span class="Identifier">}</span>)



                    console.log(<span class="Constant">&quot;line 896: &quot;</span>+(<span class="Statement">new</span> <span class="Type">Date</span>().getTime()-start_time)+<span class="Constant">&quot;ms&quot;</span>);

                    <span class="Comment">/*$(&quot;.recording&quot;).draggable({cancel: &quot;none&quot;,stack:'.recording',helper: &quot;clone&quot;,</span>
<span class="Comment">                        scroll : false ,distance: 50,</span>
<span class="Comment">                        &quot;revert&quot;: function(a) {</span>

<span class="Comment">                            if (a == false) {</span>
<span class="Comment">                                $.ajax({</span>
<span class="Comment">                                    type: 'POST',</span>
<span class="Comment">                                    url: 'moverecording.php',</span>
<span class="Comment">                                    data: {rowid:$(this).attr('title'),newcat:'null'}</span>
<span class="Comment">                                });</span>
<span class="Comment">                                recordings_revision += 1;</span>
<span class="Comment">                                $.each($(&quot;#recordings .recording&quot;), function(i, element) {</span>
<span class="Comment">                                    if (parseInt($(this).attr(&quot;title&quot;)) &gt; parseInt($(element).attr(&quot;title&quot;))) {</span>
<span class="Comment">                                        $(element).before($(this));</span>
<span class="Comment">                                        return false;</span>
<span class="Comment">                                    }</span>
<span class="Comment">                                })</span>
<span class="Comment">                            }</span>
<span class="Comment">                        }});*/</span>

                    console.log(<span class="Constant">&quot;line 919: &quot;</span>+(<span class="Statement">new</span> <span class="Type">Date</span>().getTime()-start_time)+<span class="Constant">&quot;ms&quot;</span>);


                    updateplaycounts();
                <span class="Identifier">}</span> <span class="Identifier">}</span>
                console.log((<span class="Statement">new</span> <span class="Type">Date</span>().getTime()-start_time)+<span class="Constant">&quot;ms&quot;</span>);

                <span class="Statement">if</span> (payload.youtube != <span class="Statement">null</span>)<span class="Identifier">{</span>
                    <span class="Statement">if</span> ($(<span class="Constant">'#youtube'</span>).length != 0) <span class="Identifier">{</span>
                        id = <span class="Constant">&quot;&quot;</span>;
                        arr = payload.youtube.link.match(<span class="Constant">&quot;(?:[</span><span class="Special">\?</span><span class="Constant">&amp;]v=|be</span><span class="Special">\/</span><span class="Constant">)([^&amp;#]*)&quot;</span>)
                        <span class="Statement">if</span> (arr.length &gt; 1)
                            id = arr<span class="Identifier">[</span>1<span class="Identifier">]</span>;

                        rand = Math.random();

                        $(<span class="Constant">'#youtube'</span>).html(<span class="Constant">''</span>);
                        $(<span class="Constant">'#youtube'</span>).html(<span class="Constant">'&lt;a href=&quot;'</span> + payload.youtube.link + <span class="Constant">'&quot;&gt;'</span> +
                        payload.youtube.name + <span class="Constant">'&lt;/a&gt;'</span> +
                        <span class="Constant">'&lt;iframe id=&quot;'</span>+rand+<span class="Constant">'&quot; type=&quot;text/html&quot; width=&quot;100%&quot; height=&quot;100%&quot;'</span>+
                        <span class="Constant">' src=&quot;<a href="http://www.youtube.com/embed/">http://www.youtube.com/embed/</a>'</span>+id+<span class="Constant">'?enablejsapi=1&amp;autohide=1&amp;showinfo=0&quot; frameborder=&quot;0&quot;/&gt;'</span>
                        );
                        <span class="Statement">if</span> (youtube_rowid !== 0) <span class="Identifier">{</span>
                            console.log(youtube_rowid);
                            callPlayer(rand, <span class="Identifier">function</span>() <span class="Identifier">{</span>
                                <span class="Comment">// This function runs once the player is ready (&quot;onYouTubePlayerReady&quot;)</span>
                                callPlayer(rand, <span class="Constant">&quot;playVideo&quot;</span>);
                                callPlayer(rand, <span class="Constant">&quot;mute&quot;</span>);
                            <span class="Identifier">}</span>);
                        <span class="Identifier">}</span>
                    <span class="Identifier">}</span>

                    youtube_rowid = payload.youtube.rowid;

                <span class="Identifier">}</span>

                <span class="Statement">if</span> (payload.teamspeak != <span class="Statement">null</span>) <span class="Identifier">{</span>
                    <span class="Statement">if</span> (payload.teamspeak.changes == <span class="Statement">null</span>) <span class="Identifier">{</span>
                        teamspeak_revision = payload.teamspeak.pop();

                        newlist = $(<span class="Constant">&quot;&lt;ul&gt;&lt;/ul&gt;&quot;</span>);

                        $.each(payload.teamspeak, <span class="Identifier">function</span> (i,a) <span class="Identifier">{</span>
                            <span class="Statement">if</span> (a.type == 1 &amp;&amp; a.<span class="Statement">parent</span> == 0) <span class="Identifier">{</span>
                                $(newlist).append(<span class="Constant">'&lt;li style=&quot;list-style-type: none;&quot; value=&quot;'</span>+a.id+<span class="Constant">'&quot;&gt;'</span>+
                                <span class="Constant">'&lt;img src=&quot;teamspeak/images/viewer/channel_open.png&quot; /&gt; '</span>+a.name+<span class="Constant">&quot;&lt;ul&gt;&lt;/ul&gt;&lt;/li&gt;&quot;</span>);
                            <span class="Identifier">}</span>
                        <span class="Identifier">}</span>);
                        $.each(payload.teamspeak, <span class="Identifier">function</span> (i,a) <span class="Identifier">{</span>
                            <span class="Statement">if</span> (a.type == 1 &amp;&amp; a.<span class="Statement">parent</span> != 0) <span class="Identifier">{</span>
                                $(newlist).find(<span class="Constant">'li[value=&quot;'</span>+a.<span class="Statement">parent</span>+<span class="Constant">'&quot;]'</span>).children(<span class="Constant">'ul'</span>).append(<span class="Constant">'&lt;li style=&quot;list-style-type: none;&quot; value=&quot;'</span>+a.id+<span class="Constant">'&quot;&gt;'</span>+
                                <span class="Constant">'&lt;img src=&quot;teamspeak/images/viewer/channel_open.png&quot; /&gt; '</span>+a.name+<span class="Constant">'&lt;ul&gt;&lt;/ul&gt;&lt;/li&gt;'</span>);
                            <span class="Identifier">}</span>
                        <span class="Identifier">}</span>);
                        $.each(payload.teamspeak, <span class="Identifier">function</span> (i,a) <span class="Identifier">{</span>
                            <span class="Statement">if</span> (a.type == 0 &amp;&amp; a.online == 1) <span class="Identifier">{</span>
                                $(newlist).find(<span class="Constant">'li[value=&quot;'</span>+a.channel+<span class="Constant">'&quot;]'</span>).children(<span class="Constant">'ul'</span>).prepend(<span class="Constant">'&lt;li style=&quot;list-style-type: none;&quot; class=&quot;ts_client&quot; value=&quot;'</span>+a.id+<span class="Constant">'&quot;&gt;'</span>+
                                <span class="Constant">'&lt;img src=&quot;teamspeak/images/viewer/client_idle.png&quot; /&gt; '</span>+a.name+<span class="Constant">'&lt;/li&gt;'</span>);
                            <span class="Identifier">}</span>
                        <span class="Identifier">}</span>);

                        $(<span class="Constant">&quot;#teamspeak&quot;</span>).html(newlist);

                    <span class="Identifier">}</span>
                <span class="Identifier">}</span>

                <span class="Statement">if</span> (payload.teamspeakchat != <span class="Statement">null</span>) <span class="Identifier">{</span>
                    <span class="Comment">//console.log(payload.teamspeakchat);</span>
                    teamspeak_chat_rowid = payload.teamspeakchat<span class="Identifier">[</span>payload.teamspeakchat.length - 1<span class="Identifier">]</span>.rowid;
                    <span class="Statement">if</span> ($(<span class="Constant">'#teamspeakchat'</span>).length == 0) <span class="Identifier">{</span>
                        $(<span class="Constant">'#teamspeak'</span>).after(<span class="Constant">'&lt;input type=&quot;text&quot; size=&quot;33&quot; class=&quot;textarea&quot; id=&quot;ytchat_input&quot; '</span>+
                                <span class="Constant">'alt=&quot;Teamspeak chat&quot; value=&quot;Teamspeak chat&quot;&gt;&lt;/input&gt;&lt;br&gt;'</span>+
                                <span class="Constant">'&lt;ul id=&quot;teamspeakchat&quot; style=&quot;padding-left:10px&quot;&gt;&lt;/ul&gt;'</span>);
                    <span class="Identifier">}</span>
                    $.each(payload.teamspeakchat, <span class="Identifier">function</span>(i,e) <span class="Identifier">{</span>
                        $(<span class="Constant">'#teamspeakchat li:nth-child(20)'</span>).remove();

                        msg = e.msg;

                        <span class="Statement">if</span> ((e.msg).search(<span class="Constant">/\[URL\](.*)\[\/URL\]/g</span>) != -1) <span class="Identifier">{</span>
                            msg = msg.replace(<span class="Constant">/\[URL\]/g</span>, <span class="Constant">'&lt;a href=&quot;'</span>)
                            msg = msg.replace(<span class="Constant">/\[\/URL\]/g</span>, <span class="Constant">'&quot;&gt;'</span>+((e.msg).match(<span class="Constant">/\[URL\](.*)\[\/URL\]/i</span>))<span class="Identifier">[</span>1<span class="Identifier">]</span>+<span class="Constant">'&lt;/a&gt;'</span>)
                        <span class="Identifier">}</span>


                        $(<span class="Constant">'#teamspeakchat'</span>).prepend(<span class="Constant">'&lt;li style=&quot;list-style-type: none;&quot;&gt;&lt;b&gt;'</span>+e.user+<span class="Constant">'&lt;/b&gt;: '</span>+msg+<span class="Constant">'&lt;/li&gt;'</span>);
                    <span class="Identifier">}</span>)
                    <span class="Statement">if</span> (focusvar == 0)<span class="Identifier">{</span>happening = <span class="Constant">true</span>;<span class="Identifier">}</span>
                <span class="Identifier">}</span>

                <span class="Statement">if</span> (payload.cookie != <span class="Statement">null</span>)<span class="Identifier">{</span>
                    cookie_rowid = payload.cookie.rowid;
                <span class="Identifier">}</span>
                <span class="Statement">if</span> (payload.online != <span class="Statement">null</span>)<span class="Identifier">{</span>
                    online = payload.online;

                <span class="Identifier">}</span>
                <span class="Statement">if</span> (online == 1) <span class="Identifier">{</span>
                    enablejukebox();
                <span class="Identifier">}</span>
                <span class="Statement">if</span> (online == 0) <span class="Identifier">{</span>
                    disablejukebox();
                <span class="Identifier">}</span>
            <span class="Identifier">}</span>
        diff = <span class="Statement">new</span> <span class="Type">Date</span>().getTime() - start_time;
        console.log(<span class="Constant">&quot;Payload function took &quot;</span> + diff + <span class="Constant">&quot;ms&quot;</span>);
        <span class="Statement">if</span> (loop == <span class="Statement">undefined</span>)
            t = setTimeout(longPoll,100);
        <span class="Identifier">}</span>
        <span class="Identifier">}</span>,
        error: <span class="Identifier">function</span>(e)<span class="Identifier">{</span>
            errorText = e.responseText;
        console.log(<span class="Constant">'longpoll error!'</span> + $(errorText).text());
        <span class="Statement">if</span> (loop == <span class="Statement">undefined</span>)
            t = setTimeout(longPoll,10000);
        <span class="Identifier">}</span>

    <span class="Identifier">}</span>);
<span class="Identifier">}</span>


<span class="Identifier">function</span> makerecordingsdraggable()<span class="Identifier">{</span>
    $(<span class="Constant">&quot;.recording&quot;</span>).draggable(<span class="Identifier">{</span>cancel: <span class="Constant">&quot;none&quot;</span>,stack:<span class="Constant">'.recording'</span>,helper: <span class="Constant">&quot;clone&quot;</span>,
        scroll : <span class="Constant">false</span> ,distance: 50,
        <span class="Constant">&quot;revert&quot;</span>: <span class="Identifier">function</span>(a) <span class="Identifier">{</span>

            <span class="Statement">if</span> (a == <span class="Constant">false</span>) <span class="Identifier">{</span>
                $.ajax(<span class="Identifier">{</span>
                    type: <span class="Constant">'POST'</span>,
                    url: <span class="Constant">'moverecording.php'</span>,
                    data: <span class="Identifier">{</span>rowid:$(<span class="Identifier">this</span>).attr(<span class="Constant">'title'</span>),newcat:<span class="Constant">'null'</span><span class="Identifier">}</span>
                <span class="Identifier">}</span>);
                recordings_revision += 1;
                $.each($(<span class="Constant">&quot;#recordings .recording&quot;</span>), <span class="Identifier">function</span>(i, element) <span class="Identifier">{</span>
                    <span class="Statement">if</span> (parseInt($(<span class="Identifier">this</span>).attr(<span class="Constant">&quot;title&quot;</span>)) &gt; parseInt($(element).attr(<span class="Constant">&quot;title&quot;</span>))) <span class="Identifier">{</span>
                        $(element).before($(<span class="Identifier">this</span>));
                        <span class="Statement">return</span> <span class="Constant">false</span>;
                    <span class="Identifier">}</span>
                <span class="Identifier">}</span>)
            <span class="Identifier">}</span>
        <span class="Identifier">}}</span>);

<span class="Identifier">}</span>



<span class="Identifier">function</span> updateplaycounts() <span class="Identifier">{</span>
    biggest = 0
    <span class="Statement">for</span> (i=0; i&lt;rec_playcounts.length; i++) <span class="Identifier">{</span>
        <span class="Statement">if</span> (rec_playcounts<span class="Identifier">[</span>i<span class="Identifier">]</span> == <span class="Statement">undefined</span>) <span class="Statement">continue</span>;
        <span class="Statement">if</span> (rec_playcounts<span class="Identifier">[</span>i<span class="Identifier">]</span> &gt; biggest)
            biggest = rec_playcounts<span class="Identifier">[</span>i<span class="Identifier">]</span>
    <span class="Identifier">}</span>
    $(<span class="Constant">&quot;.recording&quot;</span>).each(<span class="Identifier">function</span>()<span class="Identifier">{</span>
        i = $(<span class="Identifier">this</span>).attr(<span class="Constant">'title'</span>);
        other_colors = (Math.floor(255 - (255 * (rec_playcounts<span class="Identifier">[</span>i<span class="Identifier">]</span> / biggest)))).toString(16);

        <span class="Statement">if</span> (other_colors.length == 1)
            other_colors = <span class="Constant">&quot;0&quot;</span> + other_colors;

        color = <span class="Constant">&quot;#&quot;</span> + other_colors + <span class="Constant">&quot;FF&quot;</span> + other_colors;
        $(<span class="Identifier">this</span>).css(<span class="Constant">'background-color'</span>,color);
    <span class="Identifier">}</span>);

<span class="Identifier">}</span>



<span class="Identifier">function</span> updatecolor()<span class="Identifier">{</span>
    console.log(username);
    $(<span class="Constant">'.'</span> + $(<span class="Constant">'#username'</span>).val()).css(<span class="Constant">'color'</span>,$(<span class="Constant">&quot;#usercolor&quot;</span>).val());
<span class="Identifier">}</span>

<span class="Comment">//NimiAlueesta focus pois</span>
$(<span class="Constant">&quot;body&quot;</span>).on(<span class="Constant">&quot;blur&quot;</span>,<span class="Constant">&quot;#username&quot;</span>,sendcolor);

<span class="Identifier">function</span> sendcolor()<span class="Identifier">{</span>
    console.log(<span class="Constant">&quot;sent color&quot;</span>);
    $.cookie(<span class="Constant">&quot;usercolor&quot;</span>, $(<span class="Constant">&quot;#usercolor&quot;</span>).val(), <span class="Identifier">{</span> expires : 10 <span class="Identifier">}</span>);
    $.cookie(<span class="Constant">&quot;shoutname&quot;</span>, $(<span class="Constant">&quot;#username&quot;</span>).val(), <span class="Identifier">{</span> expires : 10 <span class="Identifier">}</span>);
    $.ajax(<span class="Identifier">{</span>
        data:<span class="Identifier">{</span>
            user:$(<span class="Constant">'#username'</span>).val(),
            color:$(<span class="Constant">&quot;#usercolor&quot;</span>).val()<span class="Identifier">}</span>,
        type:<span class="Constant">'GET'</span>,
        url:<span class="Constant">'updatecolor.php'</span>
    <span class="Identifier">}</span>);
<span class="Identifier">}</span>

<span class="Identifier">function</span> updateTJt()<span class="Identifier">{</span>
    $.ajax(<span class="Identifier">{</span>
            data:<span class="Identifier">{</span>rowcount:$(<span class="Constant">'#tjt &gt; ul &gt; li'</span>).length<span class="Identifier">}</span>,
            type:<span class="Constant">'POST'</span>,
            url:<span class="Constant">'tj.php'</span>,
            success: <span class="Identifier">function</span> (data)<span class="Identifier">{</span>
                <span class="Statement">if</span> (data.length &gt; 0)<span class="Identifier">{</span>
                $(<span class="Constant">'#tjt'</span>).html(data);
                <span class="Identifier">}</span>
            <span class="Identifier">}</span>
    <span class="Identifier">}</span>);
<span class="Identifier">}</span>


<span class="Identifier">function</span> editVitsi(id,v)<span class="Identifier">{</span>
    $.ajax(<span class="Identifier">{</span>
        type: <span class="Constant">'POST'</span>,
        url: <span class="Constant">'vitsisivusc.php'</span>,
        data: <span class="Identifier">{</span>dothis:2,id:id,newname:v<span class="Identifier">}</span>
    <span class="Identifier">}</span>);
<span class="Identifier">}</span>

<span class="Identifier">function</span> deleteVitsi(id)<span class="Identifier">{</span>
    $(<span class="Constant">&quot;#&quot;</span>+id).fadeOut(<span class="Constant">'fast'</span>);
    $.ajax(<span class="Identifier">{</span>
        data:<span class="Identifier">{</span>dothis:1,id:id<span class="Identifier">}</span>,
        type:<span class="Constant">'POST'</span>,
        url:<span class="Constant">'vitsisivusc.php'</span>
    <span class="Identifier">}</span>);
<span class="Identifier">}</span>

<span class="Identifier">function</span> disablejukebox()<span class="Identifier">{</span>

    $(<span class="Constant">'#recordbutton'</span>).css(<span class="Constant">'color'</span>, <span class="Constant">'black'</span>);
    $(<span class="Constant">'#recordbutton'</span>).text(<span class="Constant">&quot;Record&quot;</span>);
    $(<span class="Constant">'#recordbutton'</span>).attr(<span class="Constant">&quot;disabled&quot;</span>,<span class="Constant">&quot;disabled&quot;</span>);
    $(<span class="Constant">'#recordbutton'</span>).removeClass(<span class="Constant">&quot;recordbutton&quot;</span>);
    $(<span class="Constant">'.sbutton'</span>).attr(<span class="Constant">&quot;disabled&quot;</span>,<span class="Constant">&quot;disabled&quot;</span>);
    $(<span class="Constant">'.recording'</span>).attr(<span class="Constant">&quot;disabled&quot;</span>,<span class="Constant">&quot;disabled&quot;</span>);
    <span class="Comment">//$('.youtube').attr('disabled','disabled');</span>
    $(<span class="Constant">'.toista'</span>).attr(<span class="Constant">'disabled'</span>,<span class="Constant">'disabled'</span>);
    $(<span class="Constant">'.stop_youtube'</span>).attr(<span class="Constant">'disabled'</span>,<span class="Constant">'disabled'</span>);
    $(<span class="Constant">'.stop'</span>).attr(<span class="Constant">'disabled'</span>,<span class="Constant">'disabled'</span>);
    $(<span class="Constant">'#kerrovitsi'</span>).attr(<span class="Constant">'disabled'</span>,<span class="Constant">'disabled'</span>);
    $(<span class="Constant">'.not_online'</span>).show()
<span class="Identifier">}</span>
<span class="Identifier">function</span> enablejukebox()<span class="Identifier">{</span>
    <span class="Statement">if</span> (recording != 1) <span class="Identifier">{</span>
    $(<span class="Constant">'#recordbutton'</span>).removeAttr(<span class="Constant">&quot;disabled&quot;</span>);
    $(<span class="Constant">'#recordbutton'</span>).addClass(<span class="Constant">&quot;recordbutton&quot;</span>);
    <span class="Identifier">}</span>
    $(<span class="Constant">'.sbutton'</span>).removeAttr(<span class="Constant">&quot;disabled&quot;</span>);
    $(<span class="Constant">'.recording'</span>).removeAttr(<span class="Constant">&quot;disabled&quot;</span>);
    <span class="Comment">//$('.youtube').removeAttr(&quot;disabled&quot;);</span>
    $(<span class="Constant">'.toista'</span>).removeAttr(<span class="Constant">&quot;disabled&quot;</span>);
    $(<span class="Constant">'.stop'</span>).removeAttr(<span class="Constant">&quot;disabled&quot;</span>);
    $(<span class="Constant">'.stop_youtube'</span>).removeAttr(<span class="Constant">&quot;disabled&quot;</span>);
    $(<span class="Constant">'#kerrovitsi'</span>).removeAttr(<span class="Constant">&quot;disabled&quot;</span>);
    $(<span class="Constant">'.not_online'</span>).hide()
<span class="Identifier">}</span>

<span class="Comment">/**</span>
<span class="Comment"> * @author       Rob W &lt;gwnRob@gmail.com&gt;</span>
<span class="Comment"> * @website      <a href="http://stackoverflow.com/a/7513356/938089">http://stackoverflow.com/a/7513356/938089</a></span>
<span class="Comment"> * @version      20131010</span>
<span class="Comment"> * @description  Executes function on a framed YouTube video (see website link)</span>
<span class="Comment"> *               For a full list of possible functions, see:</span>
<span class="Comment"> *               <a href="https://developers.google.com/youtube/js_api_reference">https://developers.google.com/youtube/js_api_reference</a></span>
<span class="Comment"> * @param String frame_id The id of (the div containing) the frame</span>
<span class="Comment"> * @param String func     Desired function to call, eg. &quot;playVideo&quot;</span>
<span class="Comment"> *        (Function)      Function to call when the player is ready.</span>
<span class="Comment"> * @param Array  args     (optional) List of arguments to pass to function func*/</span>

<span class="Identifier">function</span> callPlayer(frame_id, func, args) <span class="Identifier">{</span>
    <span class="Statement">if</span> (<span class="Statement">window</span>.jQuery &amp;&amp; frame_id <span class="Statement">instanceof</span> jQuery) frame_id = frame_id.get(0).id;
    <span class="Identifier">var</span> iframe = <span class="Statement">document</span>.getElementById(frame_id);
    <span class="Statement">if</span> (iframe &amp;&amp; iframe.tagName.toUpperCase() != <span class="Constant">'IFRAME'</span>) <span class="Identifier">{</span>
        iframe = iframe.getElementsByTagName(<span class="Constant">'iframe'</span>)<span class="Identifier">[</span>0<span class="Identifier">]</span>;
    <span class="Identifier">}</span>
    console.log(iframe);

    <span class="Comment">// When the player is not ready yet, add the event to a queue</span>
    <span class="Comment">// Each frame_id is associated with an own queue.</span>
    <span class="Comment">// Each queue has three possible states:</span>
    <span class="Comment">//  undefined = uninitialised / array = queue / 0 = ready</span>
    <span class="Statement">if</span> (!callPlayer.queue) callPlayer.queue = <span class="Identifier">{}</span>;
    <span class="Identifier">var</span> queue = callPlayer.queue<span class="Identifier">[</span>frame_id<span class="Identifier">]</span>,
        domReady = <span class="Statement">document</span>.readyState == <span class="Constant">'complete'</span>;

    <span class="Statement">if</span> (domReady &amp;&amp; !iframe) <span class="Identifier">{</span>
        <span class="Comment">// DOM is ready and iframe does not exist. Log a message</span>
        <span class="Statement">window</span>.console &amp;&amp; console.log(<span class="Constant">'callPlayer: Frame not found; id='</span> + frame_id);
        <span class="Statement">if</span> (queue) clearInterval(queue.poller);
    <span class="Identifier">}</span> <span class="Statement">else</span> <span class="Statement">if</span> (func === <span class="Constant">'listening'</span>) <span class="Identifier">{</span>
        <span class="Comment">// Sending the &quot;listener&quot; message to the frame, to request status updates</span>
        <span class="Statement">if</span> (iframe &amp;&amp; iframe.contentWindow) <span class="Identifier">{</span>
            func = <span class="Constant">'{&quot;event&quot;:&quot;listening&quot;,&quot;id&quot;:'</span> + JSON.stringify(<span class="Constant">''</span>+frame_id) + <span class="Constant">'}'</span>;
            iframe.contentWindow.postMessage(func, <span class="Constant">'*'</span>);
        <span class="Identifier">}</span>
    <span class="Identifier">}</span> <span class="Statement">else</span> <span class="Statement">if</span> (!domReady ||
               iframe &amp;&amp; (!iframe.contentWindow || queue &amp;&amp; !queue.ready) ||
               (!queue || !queue.ready) &amp;&amp; <span class="Statement">typeof</span> func === <span class="Constant">'function'</span>) <span class="Identifier">{</span>
        <span class="Statement">if</span> (!queue) queue = callPlayer.queue<span class="Identifier">[</span>frame_id<span class="Identifier">]</span> = <span class="Identifier">[]</span>;
        queue.push(<span class="Identifier">[</span>func, args<span class="Identifier">]</span>);
        <span class="Statement">if</span> (!(<span class="Constant">'poller'</span> <span class="Statement">in</span> queue)) <span class="Identifier">{</span>
            <span class="Comment">// keep polling until the document and frame is ready</span>
            queue.poller = setInterval(<span class="Identifier">function</span>() <span class="Identifier">{</span>
                callPlayer(frame_id, <span class="Constant">'listening'</span>);
            <span class="Identifier">}</span>, 250);
            <span class="Comment">// Add a global &quot;message&quot; event listener, to catch status updates:</span>
            messageEvent(1, <span class="Identifier">function</span> runOnceReady(e) <span class="Identifier">{</span>
                <span class="Statement">if</span> (!iframe) <span class="Identifier">{</span>
                    iframe = <span class="Statement">document</span>.getElementById(frame_id);
                    <span class="Statement">if</span> (!iframe) <span class="Statement">return</span>;
                    <span class="Statement">if</span> (iframe.tagName.toUpperCase() != <span class="Constant">'IFRAME'</span>) <span class="Identifier">{</span>
                        iframe = iframe.getElementsByTagName(<span class="Constant">'iframe'</span>)<span class="Identifier">[</span>0<span class="Identifier">]</span>;
                        <span class="Statement">if</span> (!iframe) <span class="Statement">return</span>;
                    <span class="Identifier">}</span>
                <span class="Identifier">}</span>
                <span class="Statement">if</span> (e.source === iframe.contentWindow) <span class="Identifier">{</span>
                    <span class="Comment">// Assume that the player is ready if we receive a</span>
                    <span class="Comment">// message from the iframe</span>
                    clearInterval(queue.poller);
                    queue.ready = <span class="Constant">true</span>;
                    messageEvent(0, runOnceReady);
                    <span class="Comment">// .. and release the queue:</span>
                    <span class="Statement">while</span> (tmp = queue.shift()) <span class="Identifier">{</span>
                        callPlayer(frame_id, tmp<span class="Identifier">[</span>0<span class="Identifier">]</span>, tmp<span class="Identifier">[</span>1<span class="Identifier">]</span>);
                    <span class="Identifier">}</span>
                <span class="Identifier">}</span>
            <span class="Identifier">}</span>, <span class="Constant">false</span>);
        <span class="Identifier">}</span>
    <span class="Identifier">}</span> <span class="Statement">else</span> <span class="Statement">if</span> (iframe &amp;&amp; iframe.contentWindow) <span class="Identifier">{</span>
        <span class="Comment">// When a function is supplied, just call it (like &quot;onYouTubePlayerReady&quot;)</span>
        <span class="Statement">if</span> (func.call) <span class="Statement">return</span> func();
        <span class="Comment">// Frame exists, send message</span>
        iframe.contentWindow.postMessage(JSON.stringify(<span class="Identifier">{</span>
            <span class="Constant">&quot;event&quot;</span>: <span class="Constant">&quot;command&quot;</span>,
            <span class="Constant">&quot;func&quot;</span>: func,
            <span class="Constant">&quot;args&quot;</span>: args || <span class="Identifier">[]</span>,
            <span class="Constant">&quot;id&quot;</span>: frame_id
        <span class="Identifier">}</span>), <span class="Constant">&quot;*&quot;</span>);
    <span class="Identifier">}</span>
    <span class="Comment">/* IE8 does not support addEventListener... */</span>
    <span class="Identifier">function</span> messageEvent(add, listener) <span class="Identifier">{</span>
        <span class="Identifier">var</span> w3 = add ? <span class="Statement">window</span>.addEventListener : <span class="Statement">window</span>.removeEventListener;
        w3 ?
            w3(<span class="Constant">'message'</span>, listener, !1)
        :
            (add ? <span class="Statement">window</span>.attachEvent : <span class="Statement">window</span>.detachEvent)(<span class="Constant">'onmessage'</span>, listener);
    <span class="Identifier">}</span>
<span class="Identifier">}</span>
</pre>
</body>
</html>
<!-- vim: set foldmethod=manual : -->
